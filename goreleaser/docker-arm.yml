dist: ../dist-pach/docker

builds:
    - id: pachd
      main: ./src/server/cmd/pachd
      binary: pachd
      env:
          - CGO_ENABLED=0
      ldflags:
          - -X {{ .Env.CLIENT_ADDITIONAL_VERSION }} -X
            "github.com/pachyderm/pachyderm/v2/src/version.AppVersion={{ .Env.VERSION }}"
      goos:
          - linux
      goarch:
          - arm64
      gcflags:
          - "all=-trimpath={{.Env.PWD}}"
archives:
    - format: binary
      builds:
          - pachctl

checksum:
    disable: true

changelog:
    skip: true

release:
    disable: true

dockers:
    - image_templates:
          - pachyderm/pachd
          - pachyderm/pachd:local
          - pachyderm/pachd-arm64
          - pachyderm/pachd-arm64:local
          - "pachyderm/pachd-arm64:{{ .Version }}"
          - "pachyderm/pachd-arm64:{{ .FullCommit }}"
      ids:
          - pachd
      goos: linux
      goarch: arm64
      skip_push: false
      dockerfile: Dockerfile.pachd
      extra_files:
          - dex-assets
          - LICENSE
          - licenses
      build_flag_templates:
          - "--network=host"
          - "--label=version={{.Version}}"
          - "--label=release={{.Version}}"
          - "--platform=linux/arm64"
